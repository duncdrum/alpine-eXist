sudo: required
dist: trusty
os: linux
language: c
services:
  - docker
env:
  global:
    - IMAGE="grantmacken/alpine-exist"
before_script:
  - docker pull "$IMAGE" || true
script:
  - docker build --pull --cache-from "$IMAGE" --tag "$IMAGE" .
  - docker run --name ex --publish 8080:8080 -d $IMAGE
  - docker ps
  - docker exec ex ls .
  - docker exec ex which java
  - docker logs ex
  - docker exec ex \
 java -jar start.jar client \
 -ouri=xmldb:exist://127.0.0.1:8080/exist/xmlrpc \
 -u admin -P admin -q -x 'system:get-version()'

after_script:
- docker images
